const { Knex } = require('knex');

exports.seed = async function(knex) {
  // Clear existing tasks first
  await knex('tasks').del();

  const tasks = [
    // Q4 2024 - Completed tasks for analytics
    {
      id: '990e8400-e29b-41d4-a716-446655440001',
      title: 'Set up CI/CD pipeline',
      description: 'Configure GitHub Actions for automated testing and deployment',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: '550e8400-e29b-41d4-a716-446655440004',
      reporter_id: '550e8400-e29b-41d4-a716-446655440002',
      status: 'done',
      priority: 'high',
      type: 'task',
      story_points: 8,
      time_estimate: 960,
      time_spent: 840,
      due_date: new Date('2024-10-15'),
      position: 1,
      completed_at: new Date('2024-10-12'),
      created_at: new Date('2024-10-01'),
      updated_at: new Date('2024-10-12'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440002',
      title: 'Database performance optimization',
      description: 'Optimize slow queries and add proper indexing to improve response times',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: '550e8400-e29b-41d4-a716-446655440004',
      reporter_id: '550e8400-e29b-41d4-a716-446655440001',
      status: 'done',
      priority: 'high',
      type: 'task',
      story_points: 5,
      time_estimate: 720,
      time_spent: 680,
      due_date: new Date('2024-10-20'),
      position: 2,
      completed_at: new Date('2024-10-18'),
      created_at: new Date('2024-10-05'),
      updated_at: new Date('2024-10-18'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440003',
      title: 'Fix authentication session timeout',
      description: 'Users are being logged out unexpectedly after 30 minutes of inactivity',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: '550e8400-e29b-41d4-a716-446655440003',
      reporter_id: '550e8400-e29b-41d4-a716-446655440005',
      status: 'done',
      priority: 'critical',
      type: 'bug',
      story_points: 3,
      time_estimate: 360,
      time_spent: 420,
      due_date: new Date('2024-10-10'),
      position: 3,
      completed_at: new Date('2024-10-09'),
      created_at: new Date('2024-10-07'),
      updated_at: new Date('2024-10-09'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440004',
      title: 'Implement dark mode toggle',
      description: 'Add dark/light theme support with user preference persistence',
      project_id: '880e8400-e29b-41d4-a716-446655440003',
      assignee_id: '550e8400-e29b-41d4-a716-446655440005',
      reporter_id: '550e8400-e29b-41d4-a716-446655440002',
      status: 'done',
      priority: 'medium',
      type: 'feature',
      story_points: 5,
      time_estimate: 480,
      time_spent: 460,
      due_date: new Date('2024-10-25'),
      position: 1,
      completed_at: new Date('2024-10-24'),
      created_at: new Date('2024-10-15'),
      updated_at: new Date('2024-10-24'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440005',
      title: 'Write API documentation',
      description: 'Create comprehensive OpenAPI documentation for all endpoints',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: '550e8400-e29b-41d4-a716-446655440003',
      reporter_id: '550e8400-e29b-41d4-a716-446655440001',
      status: 'done',
      priority: 'medium',
      type: 'task',
      story_points: 3,
      time_estimate: 480,
      time_spent: 520,
      due_date: new Date('2024-11-01'),
      position: 4,
      completed_at: new Date('2024-10-30'),
      created_at: new Date('2024-10-20'),
      updated_at: new Date('2024-10-30'),
    },
    
    // November 2024 tasks
    {
      id: '990e8400-e29b-41d4-a716-446655440006',
      title: 'Add unit tests for authentication service',
      description: 'Write comprehensive unit tests to improve code coverage for auth module',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: '550e8400-e29b-41d4-a716-446655440004',
      reporter_id: '550e8400-e29b-41d4-a716-446655440002',
      status: 'done',
      priority: 'medium',
      type: 'task',
      story_points: 5,
      time_estimate: 600,
      time_spent: 580,
      due_date: new Date('2024-11-10'),
      position: 5,
      completed_at: new Date('2024-11-08'),
      created_at: new Date('2024-11-01'),
      updated_at: new Date('2024-11-08'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440007',
      title: 'Implement file upload functionality',
      description: 'Allow users to attach files to tasks with proper validation and security',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: '550e8400-e29b-41d4-a716-446655440003',
      reporter_id: '550e8400-e29b-41d4-a716-446655440002',
      status: 'done',
      priority: 'high',
      type: 'feature',
      story_points: 8,
      time_estimate: 960,
      time_spent: 1020,
      due_date: new Date('2024-11-15'),
      position: 6,
      completed_at: new Date('2024-11-14'),
      created_at: new Date('2024-11-01'),
      updated_at: new Date('2024-11-14'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440008',
      title: 'Fix memory leak in WebSocket connection',
      description: 'WebSocket connections are not being properly cleaned up causing memory issues',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: '550e8400-e29b-41d4-a716-446655440004',
      reporter_id: '550e8400-e29b-41d4-a716-446655440003',
      status: 'done',
      priority: 'critical',
      type: 'bug',
      story_points: 5,
      time_estimate: 480,
      time_spent: 360,
      due_date: new Date('2024-11-08'),
      position: 7,
      completed_at: new Date('2024-11-07'),
      created_at: new Date('2024-11-05'),
      updated_at: new Date('2024-11-07'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440009',
      title: 'Design user onboarding flow',
      description: 'Create intuitive onboarding experience for new users with interactive tutorials',
      project_id: '880e8400-e29b-41d4-a716-446655440003',
      assignee_id: '550e8400-e29b-41d4-a716-446655440005',
      reporter_id: '550e8400-e29b-41d4-a716-446655440002',
      status: 'done',
      priority: 'high',
      type: 'feature',
      story_points: 8,
      time_estimate: 720,
      time_spent: 780,
      due_date: new Date('2024-11-20'),
      position: 2,
      completed_at: new Date('2024-11-18'),
      created_at: new Date('2024-11-05'),
      updated_at: new Date('2024-11-18'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440010',
      title: 'Optimize bundle size',
      description: 'Reduce JavaScript bundle size by implementing code splitting and tree shaking',
      project_id: '880e8400-e29b-41d4-a716-446655440003',
      assignee_id: '550e8400-e29b-41d4-a716-446655440004',
      reporter_id: '550e8400-e29b-41d4-a716-446655440001',
      status: 'done',
      priority: 'medium',
      type: 'task',
      story_points: 5,
      time_estimate: 600,
      time_spent: 640,
      due_date: new Date('2024-11-25'),
      position: 8,
      completed_at: new Date('2024-11-23'),
      created_at: new Date('2024-11-10'),
      updated_at: new Date('2024-11-23'),
    },

    // December 2024 tasks
    {
      id: '990e8400-e29b-41d4-a716-446655440011',
      title: 'Implement email notifications',
      description: 'Send email notifications for task assignments, updates, and deadlines',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: '550e8400-e29b-41d4-a716-446655440003',
      reporter_id: '550e8400-e29b-41d4-a716-446655440002',
      status: 'done',
      priority: 'high',
      type: 'feature',
      story_points: 8,
      time_estimate: 960,
      time_spent: 900,
      due_date: new Date('2024-12-05'),
      position: 9,
      completed_at: new Date('2024-12-03'),
      created_at: new Date('2024-11-20'),
      updated_at: new Date('2024-12-03'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440012',
      title: 'Add task time tracking',
      description: 'Implement time tracking functionality with start/stop timers and reporting',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: '550e8400-e29b-41d4-a716-446655440004',
      reporter_id: '550e8400-e29b-41d4-a716-446655440001',
      status: 'done',
      priority: 'high',
      type: 'feature',
      story_points: 13,
      time_estimate: 1200,
      time_spent: 1320,
      due_date: new Date('2024-12-15'),
      position: 10,
      completed_at: new Date('2024-12-12'),
      created_at: new Date('2024-11-25'),
      updated_at: new Date('2024-12-12'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440013',
      title: 'Fix drag and drop sorting bug',
      description: 'Task positions are not saving correctly after drag and drop reordering',
      project_id: '880e8400-e29b-41d4-a716-446655440003',
      assignee_id: '550e8400-e29b-41d4-a716-446655440005',
      reporter_id: '550e8400-e29b-41d4-a716-446655440004',
      status: 'done',
      priority: 'medium',
      type: 'bug',
      story_points: 3,
      time_estimate: 240,
      time_spent: 180,
      due_date: new Date('2024-12-08'),
      position: 3,
      completed_at: new Date('2024-12-06'),
      created_at: new Date('2024-12-01'),
      updated_at: new Date('2024-12-06'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440014',
      title: 'Create analytics dashboard',
      description: 'Build comprehensive analytics dashboard with charts and metrics',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: '550e8400-e29b-41d4-a716-446655440003',
      reporter_id: '550e8400-e29b-41d4-a716-446655440002',
      status: 'done',
      priority: 'medium',
      type: 'feature',
      story_points: 13,
      time_estimate: 1440,
      time_spent: 1380,
      due_date: new Date('2024-12-20'),
      position: 11,
      completed_at: new Date('2024-12-18'),
      created_at: new Date('2024-12-01'),
      updated_at: new Date('2024-12-18'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440015',
      title: 'Security audit and improvements',
      description: 'Conduct security review and implement necessary security enhancements',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: '550e8400-e29b-41d4-a716-446655440004',
      reporter_id: '550e8400-e29b-41d4-a716-446655440001',
      status: 'done',
      priority: 'high',
      type: 'task',
      story_points: 8,
      time_estimate: 960,
      time_spent: 1080,
      due_date: new Date('2024-12-30'),
      position: 12,
      completed_at: new Date('2024-12-28'),
      created_at: new Date('2024-12-10'),
      updated_at: new Date('2024-12-28'),
    },

    // January 2025 - Current work in progress
    {
      id: '990e8400-e29b-41d4-a716-446655440016',
      title: 'Implement real-time collaboration features',
      description: 'Add live editing indicators and real-time presence for multiple users',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: '550e8400-e29b-41d4-a716-446655440003',
      reporter_id: '550e8400-e29b-41d4-a716-446655440002',
      status: 'done',
      priority: 'high',
      type: 'feature',
      story_points: 13,
      time_estimate: 1200,
      time_spent: 1150,
      due_date: new Date('2025-01-15'),
      position: 13,
      completed_at: new Date('2025-01-12'),
      created_at: new Date('2025-01-01'),
      updated_at: new Date('2025-01-12'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440017',
      title: 'Add advanced filtering and search',
      description: 'Implement comprehensive filtering options and full-text search capabilities',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: '550e8400-e29b-41d4-a716-446655440004',
      reporter_id: '550e8400-e29b-41d4-a716-446655440001',
      status: 'done',
      priority: 'medium',
      type: 'feature',
      story_points: 8,
      time_estimate: 960,
      time_spent: 920,
      due_date: new Date('2025-01-25'),
      position: 14,
      completed_at: new Date('2025-01-22'),
      created_at: new Date('2025-01-05'),
      updated_at: new Date('2025-01-22'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440018',
      title: 'Fix mobile responsive layout issues',
      description: 'Several UI components are not displaying correctly on mobile devices',
      project_id: '880e8400-e29b-41d4-a716-446655440003',
      assignee_id: '550e8400-e29b-41d4-a716-446655440005',
      reporter_id: '550e8400-e29b-41d4-a716-446655440003',
      status: 'in_progress',
      priority: 'high',
      type: 'bug',
      story_points: 5,
      time_estimate: 480,
      time_spent: 240,
      due_date: new Date('2025-02-05'),
      position: 4,
      started_at: new Date('2025-01-28'),
      created_at: new Date('2025-01-25'),
      updated_at: new Date('2025-02-01'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440019',
      title: 'Implement AI-powered task categorization',
      description: 'Use machine learning to automatically categorize tasks based on content',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: '550e8400-e29b-41d4-a716-446655440003',
      reporter_id: '550e8400-e29b-41d4-a716-446655440002',
      status: 'in_progress',
      priority: 'medium',
      type: 'feature',
      story_points: 13,
      time_estimate: 1440,
      time_spent: 480,
      due_date: new Date('2025-02-20'),
      position: 15,
      started_at: new Date('2025-02-01'),
      created_at: new Date('2025-01-20'),
      updated_at: new Date('2025-02-05'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440020',
      title: 'Add team performance metrics',
      description: 'Create detailed performance analytics for teams and individuals',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: '550e8400-e29b-41d4-a716-446655440004',
      reporter_id: '550e8400-e29b-41d4-a716-446655440001',
      status: 'in_progress',
      priority: 'medium',
      type: 'feature',
      story_points: 8,
      time_estimate: 720,
      time_spent: 360,
      due_date: new Date('2025-02-15'),
      position: 16,
      started_at: new Date('2025-02-01'),
      created_at: new Date('2025-01-15'),
      updated_at: new Date('2025-02-08'),
    },

    // February 2025 - Recent and upcoming tasks
    {
      id: '990e8400-e29b-41d4-a716-446655440021',
      title: 'Optimize database queries for large datasets',
      description: 'Performance degradation when loading projects with 1000+ tasks',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: '550e8400-e29b-41d4-a716-446655440004',
      reporter_id: '550e8400-e29b-41d4-a716-446655440003',
      status: 'in_review',
      priority: 'high',
      type: 'bug',
      story_points: 5,
      time_estimate: 600,
      time_spent: 580,
      due_date: new Date('2025-02-12'),
      position: 17,
      created_at: new Date('2025-02-01'),
      updated_at: new Date('2025-02-10'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440022',
      title: 'Add keyboard shortcuts',
      description: 'Implement common keyboard shortcuts for power users (Ctrl+N, Ctrl+S, etc.)',
      project_id: '880e8400-e29b-41d4-a716-446655440003',
      assignee_id: '550e8400-e29b-41d4-a716-446655440005',
      reporter_id: '550e8400-e29b-41d4-a716-446655440002',
      status: 'todo',
      priority: 'low',
      type: 'feature',
      story_points: 3,
      time_estimate: 360,
      time_spent: 0,
      due_date: new Date('2025-03-01'),
      position: 5,
      created_at: new Date('2025-02-05'),
      updated_at: new Date('2025-02-05'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440023',
      title: 'Write integration tests for API endpoints',
      description: 'Create comprehensive integration test suite for all REST API endpoints',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: null,
      reporter_id: '550e8400-e29b-41d4-a716-446655440001',
      status: 'todo',
      priority: 'medium',
      type: 'task',
      story_points: 8,
      time_estimate: 960,
      time_spent: 0,
      due_date: new Date('2025-02-28'),
      position: 18,
      created_at: new Date('2025-02-08'),
      updated_at: new Date('2025-02-08'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440024',
      title: 'Implement data export functionality',
      description: 'Allow users to export project data to CSV, Excel, and JSON formats',
      project_id: '880e8400-e29b-41d4-a716-446655440001',
      assignee_id: '550e8400-e29b-41d4-a716-446655440003',
      reporter_id: '550e8400-e29b-41d4-a716-446655440002',
      status: 'todo',
      priority: 'medium',
      type: 'feature',
      story_points: 5,
      time_estimate: 600,
      time_spent: 0,
      due_date: new Date('2025-03-10'),
      position: 19,
      created_at: new Date('2025-02-10'),
      updated_at: new Date('2025-02-10'),
    },
    {
      id: '990e8400-e29b-41d4-a716-446655440025',
      title: 'Fix timezone display issues',
      description: 'Task due dates are showing in UTC instead of user\'s local timezone',
      project_id: '880e8400-e29b-41d4-a716-446655440003',
      assignee_id: '550e8400-e29b-41d4-a716-446655440005',
      reporter_id: '550e8400-e29b-41d4-a716-446655440004',
      status: 'todo',
      priority: 'medium',
      type: 'bug',
      story_points: 3,
      time_estimate: 240,
      time_spent: 0,
      due_date: new Date('2025-02-20'),
      position: 6,
      created_at: new Date('2025-02-11'),
      updated_at: new Date('2025-02-11'),
    }
  ];

  // Add more tasks programmatically to reach 100+ tasks
  const additionalTasks = [];
  const taskTypes = ['feature', 'bug', 'task', 'epic'];
  const priorities = ['low', 'medium', 'high', 'critical'];
  const statuses = ['todo', 'in_progress', 'in_review', 'done'];
  const users = [
    '550e8400-e29b-41d4-a716-446655440001',
    '550e8400-e29b-41d4-a716-446655440002', 
    '550e8400-e29b-41d4-a716-446655440003',
    '550e8400-e29b-41d4-a716-446655440004',
    '550e8400-e29b-41d4-a716-446655440005'
  ];
  const projects = [
    '880e8400-e29b-41d4-a716-446655440001',
    '880e8400-e29b-41d4-a716-446655440002',
    '880e8400-e29b-41d4-a716-446655440003'
  ];

  const taskTitles = [
    'Refactor legacy authentication code',
    'Update third-party dependencies',
    'Add error logging and monitoring',
    'Implement pagination for task lists',
    'Create user profile management',
    'Add bulk task operations',
    'Implement task templates',
    'Add custom field support',
    'Create project dashboard',
    'Implement role-based permissions',
    'Add task dependencies tracking',
    'Create backup and restore functionality',
    'Implement webhook notifications',
    'Add multi-language support',
    'Create mobile app prototype',
    'Implement offline mode support',
    'Add calendar integration',
    'Create automated testing pipeline',
    'Implement caching layer',
    'Add user activity tracking',
    'Create admin panel',
    'Implement data validation',
    'Add file compression for uploads',
    'Create email digest notifications',
    'Implement search suggestions',
    'Add drag-and-drop file uploads',
    'Create project templates',
    'Implement real-time notifications',
    'Add task automation rules',
    'Create performance monitoring dashboard',
    'Implement SSO integration',
    'Add custom reporting features',
    'Create API rate limiting',
    'Implement user preferences',
    'Add team collaboration tools',
    'Create mobile responsive design',
    'Implement version control for tasks',
    'Add advanced search filters',
    'Create integration with Slack',
    'Implement task reminders',
    'Add project analytics',
    'Create user onboarding tutorial',
    'Implement data archiving',
    'Add task commenting system',
    'Create project roadmap view',
    'Implement user notification preferences',
    'Add task prioritization algorithm',
    'Create automated backups',
    'Implement load balancing',
    'Add custom dashboard widgets',
    'Create API documentation portal',
    'Implement user session management',
    'Add task estimation tools',
    'Create project milestone tracking',
    'Implement advanced user roles',
    'Add integration testing framework',
    'Create performance benchmarks',
    'Implement database sharding',
    'Add custom theme support',
    'Create user feedback system',
    'Implement task workflows',
    'Add project cost tracking',
    'Create automated deployment',
    'Implement security headers',
    'Add task burn-down charts',
    'Create user activity logs',
    'Implement feature flags',
    'Add custom field validation',
    'Create project health metrics',
    'Implement GraphQL API',
    'Add task batch processing',
    'Create user directory service',
    'Implement audit trail',
    'Add task approval workflows',
    'Create project comparison tools',
    'Implement distributed caching',
    'Add task scheduling system',
    'Create user permission matrix',
    'Implement real-time chat'
  ];

  // Generate 75 more tasks across different time periods
  for (let i = 0; i < 75; i++) {
    const randomDate = new Date(2024, Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1);
    const completedDate = Math.random() > 0.4 ? new Date(randomDate.getTime() + Math.random() * 60 * 24 * 60 * 60 * 1000) : null;
    const status = completedDate ? 'done' : statuses[Math.floor(Math.random() * statuses.length)];
    const timeSpent = completedDate ? Math.floor(Math.random() * 800) + 100 : Math.floor(Math.random() * 400);
    
    additionalTasks.push({
      id: `990e8400-e29b-41d4-a716-44665544${String(26 + i).padStart(4, '0')}`,
      title: taskTitles[i % taskTitles.length],
      description: `Task description for ${taskTitles[i % taskTitles.length].toLowerCase()}`,
      project_id: projects[Math.floor(Math.random() * projects.length)],
      assignee_id: Math.random() > 0.15 ? users[Math.floor(Math.random() * users.length)] : null,
      reporter_id: users[Math.floor(Math.random() * users.length)],
      status,
      priority: priorities[Math.floor(Math.random() * priorities.length)],
      type: taskTypes[Math.floor(Math.random() * taskTypes.length)],
      story_points: [1, 2, 3, 5, 8, 13][Math.floor(Math.random() * 6)],
      time_estimate: Math.floor(Math.random() * 1000) + 200,
      time_spent: timeSpent,
      due_date: new Date(randomDate.getTime() + (Math.random() * 30 + 7) * 24 * 60 * 60 * 1000),
      position: i + 20,
      completed_at: completedDate,
      started_at: status === 'in_progress' || completedDate ? new Date(randomDate.getTime() + Math.random() * 7 * 24 * 60 * 60 * 1000) : null,
      created_at: randomDate,
      updated_at: completedDate || new Date(randomDate.getTime() + Math.random() * 14 * 24 * 60 * 60 * 1000),
    });
  }

  await knex('tasks').insert([...tasks, ...additionalTasks]);
};